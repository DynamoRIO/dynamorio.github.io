---
title: "Simulator Details"
layout: default
permalink: /sec_drcachesim_sim.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DynamoRIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Simulator Details </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Generally, the simulator is able to be extended to model a variety of caching devices. Currently, CPU caches and TLBs are implemented. The type of devices to simulate can be specified by the parameter "-tool" (see <a class="el" href="sec_drcachesim_ops.html">Simulator Parameters</a>).</p>
<p>The CPU cache simulator models a configurable number of cores, each with an L1 data cache and an L1 instruction cache. Currently there is a single shared L2 unified cache, but we would like to extend support to arbitrary cache hierarchies (see <a class="el" href="sec_drcachesim_limit.html">Current Limitations</a>). The cache line size and each cache's total size and associativity are user-specified (see <a class="el" href="sec_drcachesim_ops.html">Simulator Parameters</a>).</p>
<p>The TLB simulator models a configurable number of cores, each with an L1 instruction TLB, an L1 data TLB, and an L2 unified TLB. Each TLB's entry number and associativity, and the virtual/physical page size, are user-specified (see <a class="el" href="sec_drcachesim_ops.html">Simulator Parameters</a>).</p>
<p>Neither simulator has a simple way to know which core any particular thread executed on for each of its instructions. The tracer records which core a thread is on each time it writes out a full trace buffer, giving an approximation of the actual scheduling: but this is not representative due to overhead (see <a class="el" href="sec_drcachesim_sched.html#sec_drcachesim_as_traced">As-Traced Schedule Limitations</a>). For online analysis, by default, these cache and TLB simulators ignore that information and schedule threads to simulated cores in a static round-robin fashion with load balancing to fill in gaps with new threads after threads exit. The option "-cpu_scheduling" (see <a class="el" href="sec_drcachesim_ops.html">Simulator Parameters</a>) can be used to instead map each physical cpu to a simulated core and use the recorded cpu that each segment of thread execution occurred on to schedule execution following the "as traced" schedule, but as just noted this is not representative. Instead, we recommend using offline traces and dynamic re-scheduling in core-sharded mode as explained in <a class="el" href="sec_drcachesim_sched.html#sec_drcachesim_sched_dynamic">Dynamic Scheduling</a> using the <code>-core_serial</code> parameter. In offline mode, <code>-core_serial</code> is the default for these simulators.</p>
<div class="fragment"><div class="line">$ bin64/drrun -t drmemtrace -offline -- ~/test/pi_estimator 8 20</div>
<div class="line">Estimation of pi is 3.141592653798125</div>
<div class="line">$ bin64/drrun -t drcachesim -cores 3 -indir drmemtrace.pi_estimator.*.dir</div>
<div class="line">Cache simulation results:</div>
<div class="line">Core #0 (traced CPU(s): #0)</div>
<div class="line">  L1I0 (size=32768, assoc=8, block=64, LRU) stats:</div>
<div class="line">    Hits:                        1,853,727</div>
<div class="line">    Misses:                          2,152</div>
<div class="line">    Compulsory misses:               2,045</div>
<div class="line">    Invalidations:                       0</div>
<div class="line">    Miss rate:                        0.12%</div>
<div class="line">  L1D0 (size=32768, assoc=8, block=64, LRU) stats:</div>
<div class="line">    Hits:                          605,114</div>
<div class="line">    Misses:                         11,973</div>
<div class="line">    Compulsory misses:               9,845</div>
<div class="line">    Invalidations:                       0</div>
<div class="line">    Prefetch hits:                   1,880</div>
<div class="line">    Prefetch misses:                10,093</div>
<div class="line">    Miss rate:                        1.94%</div>
<div class="line">Core #1 (traced CPU(s): #1)</div>
<div class="line">  L1I1 (size=32768, assoc=8, block=64, LRU) stats:</div>
<div class="line">    Hits:                          942,992</div>
<div class="line">    Misses:                            461</div>
<div class="line">    Compulsory misses:                 366</div>
<div class="line">    Invalidations:                       0</div>
<div class="line">    Miss rate:                        0.05%</div>
<div class="line">  L1D1 (size=32768, assoc=8, block=64, LRU) stats:</div>
<div class="line">    Hits:                          385,134</div>
<div class="line">    Misses:                            534</div>
<div class="line">    Compulsory misses:                 775</div>
<div class="line">    Invalidations:                       0</div>
<div class="line">    Prefetch hits:                     144</div>
<div class="line">    Prefetch misses:                   390</div>
<div class="line">    Miss rate:                        0.14%</div>
<div class="line">Core #2 (traced CPU(s): #2)</div>
<div class="line">  L1I2 (size=32768, assoc=8, block=64, LRU) stats:</div>
<div class="line">    Hits:                          944,622</div>
<div class="line">    Misses:                            453</div>
<div class="line">    Compulsory misses:                 365</div>
<div class="line">    Invalidations:                       0</div>
<div class="line">    Miss rate:                        0.05%</div>
<div class="line">  L1D2 (size=32768, assoc=8, block=64, LRU) stats:</div>
<div class="line">    Hits:                          385,808</div>
<div class="line">    Misses:                            537</div>
<div class="line">    Compulsory misses:                 791</div>
<div class="line">    Invalidations:                       0</div>
<div class="line">    Prefetch hits:                     140</div>
<div class="line">    Prefetch misses:                   397</div>
<div class="line">    Miss rate:                        0.14%</div>
<div class="line">LL (size=8388608, assoc=16, block=64, LRU) stats:</div>
<div class="line">    Hits:                            8,091</div>
<div class="line">    Misses:                          8,019</div>
<div class="line">    Compulsory misses:              13,173</div>
<div class="line">    Invalidations:                       0</div>
<div class="line">    Prefetch hits:                   5,693</div>
<div class="line">    Prefetch misses:                 5,187</div>
<div class="line">    Local miss rate:                 49.78%</div>
<div class="line">    Child hits:                  5,119,561</div>
<div class="line">    Total miss rate:                  0.16%</div>
</div><!-- fragment --><p>The memory access traces contain some optimizations that combine references for one basic block together. This may result in not considering some thread interleavings that could occur natively. There are no other disruptions to thread ordering, however, and the application runs with all of its threads concurrently just like it would natively (although slower).</p>
<p>Once every process has exited, the simulator prints cache miss statistics for each cache to stderr. The simulator is designed to be extensible, allowing for different cache studies to be carried out: see <a class="el" href="sec_drcachesim_extend.html">Extending the Simulator</a>.</p>
<p>For L2 caching devices, the L1 caching devices are considered its <em>children</em>. Two separate miss rates are computed, one (the "Local miss rate") considering just requests that reach L2 while the other (the "Total miss rate") includes the child hits. This generalizes to deeper hierarchies: lower level caches are children and reported child hits are cumulative across all lower levels.</p>
<p>For memory requests that cross blocks, each block touched is considered separately, resulting in separate hit and miss statistics. This can be changed by implementing a custom statistics gatherer (see <a class="el" href="sec_drcachesim_extend.html">Extending the Simulator</a>).</p>
<p>Software and hardware prefetches are combined in the prefetch hit and miss statistics, which are reported separately from regular loads and stores. To isolate software prefetch statistics, disable the hardware prefetcher by running with "-data_prefetcher none" (see <a class="el" href="sec_drcachesim_ops.html">Simulator Parameters</a>). While misses from software prefetches are included in cache miss files, misses from hardware prefetches are not. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer" style="float:none;text-align:center"><img border=0 src="favicon.png"> &nbsp;  DynamoRIO version 11.90.20112 --- Fri Jan 24 2025 03:17:43 &nbsp; <img border=0 src="favicon.png">
</small></address>
